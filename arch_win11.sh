#!/bin/bash
clear
setfont cyr-sun16
echo '

                                     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó     ‚ñà‚ñà‚ïó
                                    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
                                    ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
                                    ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ïö‚ïê‚ïê‚ïê‚ïê‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë
                                    ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
                                    ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚ïö‚ïê‚ïù   ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù



'
sleep 2
clear
stop_() {
#---–∑–∞–≥–ª—É—à–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–≤–æ–¥–∞ –∫–æ–º–º–∞–Ω–¥
read -p "Press key to continue.. " -n1 -s
}
#---------------------------------------------------------------------


setfont ter-v32b
#setfont cyr-sun16
#-----------–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Enternet---------
#--------fynction  "mywifi"----- WIFI conect-------------
mywifi() {
#clear
iwctl device list
read -p '                                    -> –í–≤–µ–¥–∏—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏–≤—à–µ–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä "wlan0" : ' namelan
iwctl station $namelan scan
iwctl station $namelan get-networks
read -p '                                    -> –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π —Å–µ—Ç–∏ –∏–∑ —Å–ø–∏—Å–∫–∞  : ' namewifi
iwctl station $namelan connect $namewifi
iwctl station $namelan show
sleep 5
 }
#-------------------------------------------------------
#clear
echo '



		        	–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï  ENTERNET CONNECT 

            
                 
'
PS3="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è 1 –∏–ª–∏ 2  –µ—Å–ª–∏ 3 - –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å  4 - –ü—Ä–µ—Ä–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É :"
select choice in "WiFi" "Lan" "–ü–†–û–ü–£–°–¢–ò–¢–¨" "–ü—Ä–µ—Ä–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É exit"; do
case $REPLY in
    1) mywifi;break;;
    2) systemctl restart dhcpcd ;dhcpcd;break;;
    3) break;;
    4) echo "see you next time";exit;;
    *) echo "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä !";;
esac
done
echo "     –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Enternet"
ping -c 3 8.8.8.8  || exit
clear
echo '


                –ï—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ !!!!!!!!'
sleep 2
#################################################################
#################################################################
#-----–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö----------
region="Europe/Moscow"
name="ArchLinux"
mirror_="RU,NL"

#################################################################
#################################################################
#####---------------–¥–∏–∞–ª–æ–≥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è namedisk-----------------------------
clear
lsblk
#fdisk -l
echo '
    –î–∏—Å–∫–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—É –≤ —Å–∏—Å—Ç–µ–º–µ
    –í–í–ï–î–ò–¢–ï –ò–ú–Ø –î–ò–°–ö–ê –î–õ–Ø –£—Å—Ç–∞–Ω–æ–≤–∫–∏ ArchLinux 
    "–Ω–∞–ø—Ä–∏–º–µ—Ä: nvme0n1 sda sdb sdc ....vda ....:)"
     '
read -p "
         wwod name disk -->: " namedisk


echo '         –í—ã –≤—ã—å—Ä–∞–ª–∏ –¥–∏—Å–∫ = '$namedisk

sleep 5

############################################################################
#----------------–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π-----------------------------------
# –í –î–ê–õ–¨–ù–ï–ô–®–ï–ú –ó–ù–ê–ß–ï–ù–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–• –ë–£–î–ï–¢ –ó–ê–ì–†–£–ñ–ï–ù–û –í –°–ò–°–¢–ï–ú–£
#
passwd_() {
clear
echo '


                –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  root


'
while true; do
  read -s -p "Password root: " password
  echo
  read -s -p "Password root(again): " password2
  echo
  [ "$password" = "$password2" ] && break
  echo "Please try again"
done

clear
echo '


                –ù–∞–∑–Ω–∞—á—å—Ç–µ –∏–º—è –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
'
read -p "Username: " username
while true; do
  echo
  read -s -p "Password: " userpassword
  echo
  read -s -p "Password (again): " userpassword2
  echo
  [ "$userpassword" = "$userpassword2" ] && break
  echo "Please try again"
done
}
#----------------------------------------------------
####################################################################
#-------------- –§—É–Ω–∫—Ü–∏—è –≤—ã–≤–æ–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –Ω–∞ —ç–∫—Ä–∞–Ω tablo2-----
tablo2() {
clear
echo "
 
    –ù–∞–∑–Ω–∞—á–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
"
echo "--------------------------------------------------------------
"
echo "–î–∏—Å–∫ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ = " $namedisk
echo "            –†–µ–≥–∏–æ–Ω = " $region
echo " –†–µ–≥–∏–æ–Ω –≥–¥–µ mirror = " $mirror_
echo "    –ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ = " $name
echo "  –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è = " $username
echo""
echo "--------------------------------------------------------------"
echo "1-–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏" "2-–ò–∑–º–µ–Ω–∏—Ç—å –¥–∏—Å–∫, —Ä–µ–≥–∏–æ–Ω, —Ä–µ–≥–∏–æ–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ " "3-–í—ã–π—Ç–∏ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo "--------------------------------------------------------------

"
}
##--------------—Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö peremen2------------
peremen2() {

read -p "
             –†–µ–≥–∏–æ–Ω –Ω–∞–ø—Ä–∏–º–µ—Ä "Europe/Moscow"   -> –í–≤–µ–¥–∏—Ç–µ wwod : " region
read -p "
 –†–µ–≥–∏–æ–Ω —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–∞—Ä–∏—è "RU,NL" "US"  -> –í–≤–µ–¥–∏—Ç–µ wwod : " mirror_                                                                                                    
read -p "
                        –ò–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ NAME PC -> –í–≤–µ–¥–∏—Ç–µ wwod : " name                                       

}

####-------------–ø–æ–∫–∞–∑—ã–≤–∞–µ–º tablo2------------------
tablo2

PS3="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ :"
echo
select choice in "–ü–†–û–î–û–õ–ñ–ò–¢–¨" "–ò–∑–º–µ–Ω–∏—Ç—å- —Ä–µ–≥–∏–æ–Ω, miror —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, name –∏–º—è –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ " "–í—ã–π—Ç–∏ –∏–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ EXIT"; do
case $REPLY in
    1) break;;
    2) peremen2;tablo2;;
    3) exit;;
    *) echo "Wrong choice!";;
esac
done
clear
####################################################################
#__–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ BOOT –ø–∞—Ä—Ç–∏—Ü–∏–∏
mkboot() {
PS3="1 –ù–µ —É–¥–∞–ª—è—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫ WINDOWS !!! 2 –ï—Å–ª–∏ –æ–¥–∏–Ω –ª–∏–Ω—É–∫—Å  :"
select choice in "–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑—á–∏–∫ —Å—Ç–∞–≤–∏—Ç—Å—è –≤ EFI- Windows!" "LINUX —Å–≤–æ–π —Ä–∞–∑–¥–µ–ª  BOOT" "–í—ã–π—Ç–∏ –∏–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ EXIT"; do
case $REPLY in
    1) break;;
    2) mkfs.vfat -F32 /dev/$boot;break;;
    3) echo "see you next time";exit;;
    *) echo "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä !";;
esac
done
}
####################################################################
#__________–§—É–Ω–∫—Ü–∏—è btrfs1_____________________________
btrfs1() {
#mkfs.vfat -F32 /dev/$boot
mkfs.btrfs -f /dev/$root
mount /dev/$root /mnt
btrfs su cr /mnt/@
btrfs su cr /mnt/@home
btrfs su cr /mnt/@log
btrfs su cr /mnt/@pkg
btrfs su cr /mnt/@.snapshots
btrfs su cr /mnt/@tmp
btrfs su cr /mnt/@swap
umount -R /mnt
sub='rw,noatime,compress=zstd:2,ssd,space_cache=v2,discard=async,subvol'
sub1='nodatacow,subvol'
mount -o ${sub}=@ /dev/$root /mnt
mkdir -p /mnt/{boot,home,var/log,var/cache/pacman/pkg,.snapshots,tmp,swap}
mount -o ${sub}=@home /dev/$root /mnt/home
mount -o ${sub}=@.snapshots /dev/$root /mnt/.snapshots
mount -o ${sub1}=@tmp /dev/$root /mnt/tmp
mount -o ${sub1}=@swap /dev/$root /mnt/swap
mount -o ${sub1}=@log /dev/$root /mnt/var/log
mount -o ${sub1}=@pkg /dev/$root /mnt/var/cache/pacman/pkg
#-----–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∑–∞–ø—Ä–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏----------
chattr +C /mnt/swap
chattr +C /mnt/tmp
chattr +C /mnt/var/log
chattr +C /mnt/var/cache/pacman/pkg
#------------------------------------------------------
#mkdir /mnt/boot
#mount /dev/$boot /mnt/boot
mkdir -p /mnt/boot/efi
mount /dev/$boot /mnt/boot/efi  # EFI-—Ä–∞–∑–¥–µ–ª

#____________________–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–ø —Ñ–∞–π–ª–∞________________________________________
btrfs filesystem mkswapfile --size 8g --uuid clear /mnt/swap/swapfile
swapon /mnt/swap/swapfile
swap_fstab='echo "/swap/swapfile none swap defaults 0 0" >> /mnt/etc/fstab'
}
#################################################################################
#__________–§—É–Ω–∫—Ü–∏—è btrfs2_____________________________
btrfs2() {
#mkfs.vfat -F32 /dev/$boot
mkfs.btrfs -f /dev/$root
mount /dev/$root /mnt
btrfs su cr /mnt/@
btrfs su cr /mnt/@home
btrfs su cr /mnt/@log
btrfs su cr /mnt/@pkg
#btrfs su cr /mnt/@.snapshots
btrfs su cr /mnt/@tmp
#btrfs su cr /mnt/@swap
umount -R /mnt
sub='rw,noatime,compress=zstd:2,ssd,space_cache=v2,discard=async,subvol'
sub1='nodatacow,subvol'
mount -o ${sub}=@ /dev/$root /mnt
#mkdir -p /mnt/{boot,home,var/log,var/cache/pacman/pkg,.snapshots,tmp,swap}
mkdir -p /mnt/{boot,home,var/log,var/cache/pacman/pkg,tmp}
mount -o ${sub}=@home /dev/$root /mnt/home
#mount -o ${sub}=@.snapshots /dev/$root /mnt/.snapshots
mount -o ${sub1}=@tmp /dev/$root /mnt/tmp
#mount -o ${sub1}=@swap /dev/$root /mnt/swap
mount -o ${sub1}=@log /dev/$root /mnt/var/log
mount -o ${sub1}=@pkg /dev/$root /mnt/var/cache/pacman/pkg
#-----–Ω–∞–∑–Ω–∞—á–∏—Ç—å –∑–∞–ø—Ä–µ—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏----------
#chattr +C /mnt/swap
chattr +C /mnt/tmp
chattr +C /mnt/var/log
chattr +C /mnt/var/cache/pacman/pkg
#------------------------------------------------------
#mkdir /mnt/boot
#mount /dev/$boot /mnt/boot
mkdir -p /mnt/boot/efi
mount /dev/$boot /mnt/boot/efi  # EFI-—Ä–∞–∑–¥–µ–ª

##____________________–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–ø —Ñ–∞–π–ª–∞________________________________________
#btrfs filesystem mkswapfile --size 8g --uuid clear /mnt/swap/swapfile
#swapon /mnt/swap/swapfile
swap_fstab=''
}
#################################################################################
#____________________________–§—É–Ω–∫—Ü–∏—è ZRAM_ --------------------
zram_() {
pacstrap -i /mnt zram-generator --noconfirm
arch-chroot /mnt /bin/bash -c "echo '[zram0]' > /etc/systemd/zram-generator.conf"
arch-chroot /mnt /bin/bash -c "echo 'ram-size = ram / 3' >> etc/systemd/zram-generator.conf"
arch-chroot /mnt /bin/bash -c "echo 'ompression-algorithm = zstd' >> /etc/systemd/zram-generator.conf"
arch-chroot /mnt /bin/bash -c "echo 'wap-priority = 100' >> /etc/systemd/zram-generator.conf"
arch-chroot /mnt /bin/bash -c "echo 's-type = swap' >> /etc/systemd/zram-generator.conf"
}
#################################################################################

#----------–î–∏–∞–ª–æ–≥ —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∏—Å–∫–∞-------------------
clear
echo '


–ù–∞ –¥–∏—Å–∫–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∏–ø GPT –∏ —Å–æ–∑–¥–∞–Ω–æ –º–∏–Ω–∏–º—É–º –¥–≤–∞ —Ä–∞–∑–¥–µ–ª–∞
 ->  boot  (512–ú –µ—Å–ª–∏ –æ–¥–Ω–æ —è–¥—Ä–æ) —Ç–∏–ø EFI System
 ->  root (–æ—Å—Ç–∞–ª—å–Ω–æ–µ  –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ) —Ç–∏–ø  Linux filesystem
root –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –±—É–¥–µ—Ç —Ä–∞–∑–º–µ—á–µ–Ω–æ –≤ BTRFS –∏ —Å–æ–∑–¥–∞–Ω—ã subvolume –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã
–º–æ–∂–Ω–æ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é —Å–æ–∑–¥–∞—Ç—å –µ—â—ë —Ä–∞–∑–¥–µ–ª—ã

'
stop_
###########################################################################################
##---------------------–†–∞–∑–º–µ—Ç–∫–∞ –¥–∏—Å–∫–∞--------------------------------------

disk_part(){
    while true; do  # –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏–∫–ª while –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤ –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
        clear    
        lsblk -f /dev/$namedisk
        fdisk -l /dev/$namedisk
        echo '---------------------------------'    
        
        fdisk_() {
            wipefs --all /dev/$namedisk
            (
            echo g;
            echo n;
            echo ;
            echo ;
            echo +512M;
            echo n;
            echo ;
            echo ;
            echo ;
            echo t;
            echo 1;
            echo 1;
            echo t;
            echo ;
            echo 20;
            echo w;
            ) | fdisk /dev/$namedisk
        }

        PS3="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: "
        select choice in "512–ú-boot –æ—Å—Ç–∞–ª—å–Ω–æ–µ-root –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è" "–ü–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –Ω–∞ –¥–∏—Å–∫–µ –≤–º–µ—Å—Ç–µ —Å —Ç–∞–±–ª–∏—Ü–µ–π —Ä–∞–∑–¥–µ–ª–æ–≤" "–†—É—á–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞. –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª—ã WINDOWS!!!!!" "–î–ê–õ–¨–®–ï (–û—Å—Ç–∞–≤–∏—Ç—å —Å —ç—Ç–∏–º–∏ —Ä–∞–∑–¥–µ–ª–∞–º–∏)" "–ó–∞–≤–µ—Ä—à–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É EXIT"; do
            case $REPLY in
                1) 
                    fdisk_ || exit
                    break  # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
                    ;;
                2) 
                    wipefs --all /dev/$namedisk || exit
                    break  # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
                    ;;
                3) 
                    cfdisk /dev/$namedisk || exit
                    break  # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
                    ;;
                4) 
                    echo "see you next time"
                    return 0  # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é
                    ;;
                5) 
                    exit
                    ;;
                *) 
                    echo "–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!"
                    ;;
            esac
        done
    done
}

# –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–∏—Å–∫–∞
disk_part $namedisk
############################################################################################
#-------------–î–∏–∞–ª–æ–≥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–π –¥–ª—è boot root--------------------------------------
clear
lsblk -f /dev/$namedisk
fdisk -l /dev/$namedisk
echo '


–í–´–ë–ï–†–ò–¢–ï –ü–ê–†–¢–ò–¶–ò–Æ  !!!<< '$namedisk '>>!!! boot –ò root'
read -p "

POLNOE NAZBANIE PARTICII (sda1...nvme0n1p1....) boot: ->:" boot
read -p "

POLNOE NAZBANIE PARTICII (sdb2...nvme0n1p2....) root: ->:" root


echo '                –í—ã –≤—ã—å—Ä–∞–ª–∏ Disk = '$namedisk
echo '                           boot = '$boot
echo '                           root = '$root
sleep 3

############################################################################################

clear
echo '

  –î–ò–°–ö –ë–£–î–ï–¢ –†–ê–ó–ú–ï–ß–ï–ù –í BTRFS
  –í—ã–±–∏—Ä–µ—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞–∑–º–µ—Ç–∫–∏ —Å—É–±–≤–æ–ª—É–º–æ–≤ :

  –í–∞—Ä–∏–∞–Ω—Ç —Å swapfile                    –í–∞—Ä–∏–∞–Ω—Ç –±–µ–∑ NOT SWAPfile
      /@                                      /@
      /@home                                  /@home
      /@log                                   /@log       var/log
      /@pkg                                   /@pkg       var/cache/pacman/pkg
      /@.snapshots                            /@tmp
      /@tmp                              –ë—É–¥–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ 
      /@swap   swapfile 8g               —Å–æ–∑–¥–∞—Ç—å SWAP –Ω–∞ ZRAM

'
PS3="–í—ã–±–∏—Ä–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ :"
select choice in "–í–∞—Ä–∏–∞–Ω—Ç —Å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–º swapfile"  "–í–∞—Ä–∏–∞–Ω—Ç —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π VIRTUAL ZRAM-SWAP" "EXIT"; do
case $REPLY in
    1) mkboot;btrfs1;break;;
    2) mkboot;btrfs2;break;;
    3) exit;;
    *) echo "Wrong choice!";;
esac
done

#---------–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ------------------------------------------------------------

#--------------------–≤—ã–±–æ—Ä —è–¥—Ä–∞ linux---------------------------------------

kernel1='pacstrap -i /mnt base base-devel linux-zen linux-zen-headers linux-firmware ntfs-3g btrfs-progs amd-ucode intel-ucode iucode-tool archlinux-keyring nano mc vim dhcpcd dhclient networkmanager wpa_supplicant iw terminus-font --noconfirm'
kernel2='pacstrap -i /mnt base base-devel linux linux-headers linux-firmware ntfs-3g btrfs-progs amd-ucode intel-ucode iucode-tool archlinux-keyring nano mc vim dhcpcd dhclient networkmanager wpa_supplicant iw terminus-font --noconfirm'
PS3="–í—ã–±–∏—Ä–µ—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ :"
select choice in "Linux-zen"  "Linux" "EXIT"; do
case $REPLY in
    1) kernel=${kernel1};break;;
    2) kernel=${kernel2};break;;
    3) exit;;
    *) echo "Wrong choice!";;
esac
done

#--------------------end-–≤—ã–±–æ—Ä —è–¥–æ–∞-----------------------------------------------------
#Uefi="grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=$name --no-nvram --removable /dev/$namedisk"
Uefi="grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --no-nvram --removable /dev/$namedisk"
#Uefi="grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB"

#------------------------–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Pacman--------------------------------|
sed -i "/\[multilib\]/,/Include/"'s/^#//' /etc/pacman.conf
sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 10'/g /etc/pacman.conf
sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf
sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf
clear
setfont cyr-sun16
echo '
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë
‚îÄ‚îÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚îÄ‚îÄ‚îÄ‚îÄ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë
‚îÄ‚ñí‚îÄ‚ñÑ‚ñí‚îÄ‚ñÑ‚ñí‚îÄ‚îÄ‚ñà‚ñà‚ñà‚ñÑ‚ñà‚ñÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë
‚îÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚îÄ‚ñê‚ñà‚ñà‚ñà‚ñà‚îÄ‚îÄ‚ñà‚îÄ‚îÄ‚ñà‚îÄ‚îÄ ‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ïö‚ïê‚ïù ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë
‚îÄ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚îÄ‚îÄ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù
‚îÄ‚ñí‚îÄ‚ñí‚îÄ‚ñí‚îÄ‚ñí‚îÄ‚îÄ‚îÄ‚ñÄ‚ñà‚ñà‚ñà‚ñà‚ñÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ|

                       –∏–¥–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–µ—Ä–∫–∞–ª —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤
'
pacman -Syy archlinux-keyring --noconfirm
pacman -Syy reflector --noconfirm
#reflector --sort rate -l 20 --save /etc/pacman.d/mirrorlist
reflector --verbose -c 'Russia' -l 10 -p https --sort rate --save /etc/pacman.d/mirrorlist
#reflector --verbose -c $mirror_ -l 20 -p https --sort rate --save /etc/pacman.d/mirrorlist
pacman -Syy archlinux-keyring --noconfirm
#--------------------------------------------------------------
# –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 
setfont ter-v32b
passwd_
setfont cyr-sun16

#---------–∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–ª—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
clear
setfont ter-v32b
echo '–ü–∞—Ä–æ–ª—å —Ä—É—Ç–∞='$password
echo '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å='$username
echo '–ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è='$userpassword
stop_
setfont cyr-sun16
#-----------------------------------------------------------------

# –∑–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞ –ª–∏–Ω—É–∫—Å
${kernel}
#------------------------------------------------------------------------
genfstab -U /mnt >> /mnt/etc/fstab
$swap_fstab
arch-chroot /mnt /bin/bash -c "ln -sf /usr/share/zoneinfo/$region /etc/localtime"
arch-chroot /mnt /bin/bash -c "hwclock --systohc"
arch-chroot /mnt /bin/bash -c "sed -i s/'#en_US.UTF-8'/'en_US.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "sed -i s/'#ru_RU.UTF-8'/'ru_RU.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "locale-gen"
arch-chroot /mnt /bin/bash -c "echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf"
arch-chroot /mnt /bin/bash -c "echo 'KEYMAP=ru' > /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo 'FONT=ter-v32b' >> /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo $name > /etc/hostname"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 localhost' > /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '::1       localhost' >> /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 $name.localdomain $name' >> /etc/hosts"
arch-chroot /mnt /bin/bash -c "sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 10'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf"
sed -i "/\[multilib\]/,/Include/"'s/^#//' /mnt/etc/pacman.conf
arch-chroot /mnt /bin/bash -c "sed -i s/'# %wheel ALL=(ALL:ALL) ALL'/'%wheel ALL=(ALL:ALL) ALL'/g /etc/sudoers"
echo "root:$password" | arch-chroot /mnt chpasswd

arch-chroot /mnt /bin/bash -c "useradd -m -G wheel -s /bin/bash $username"
echo "$username:$userpassword" | arch-chroot /mnt chpasswd
arch-chroot /mnt /bin/bash -c "systemctl enable NetworkManager"
#arch-chroot /mnt /bin/bash -c "mkinitcpio -P" # –∫–æ–º–ø–∏–ª—è—Ü–∏—è —è–¥—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑—á–∏–∫–∞

##############################################################################################
#________________________ZRAM_________________________________________________
clear
setfont ter-v32b
echo '

    –°–µ–π—á–∞—Å –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∏—Å–∫ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ–º SWOP
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω –∑–∞–π–º–µ—Ç 1/3 –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏
    –í –¥–∞–ª—å–Ω–µ–π—à–µ–º —Ä–∞–∑–º–µ—Ä –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª–µ /etc/systemd/zram-generator.conf
    –∏–∑–º–µ–Ω–∏–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä zram-size



'
PS3="–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ :"
select choice in "–ü–æ–¥–∫–ª—é—á–∏—Ç—å  ZRAM" " –î–ê–õ–¨–®–ï"; do
case $REPLY in
    1) zram_;break;;
    2) break;;
    *) echo "Wrong choice!";;
esac
done
#clear
###################################################################################################
#===============  –§—É–Ω–∫—Ü–∏—è zagruzcik ==========================================================================
zagruzchik(){ 
while true; do  # –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏–∫–ª while –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤ –±–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
   clear
   echo '
    –ï–°–õ–ò –û–î–ò–ù –õ–ò–ù–£–ö–° –î–û–°–¢–ê–¢–û–ß–ù–û –¢–û–õ–¨–ö–û 1)
    –ï–°–õ–ò –†–Ø–î–û–ú –° –í–ò–ù–î–û–í–° –¢–û –ï–©–ï –ù–ï–û–ë–•–û–î–ò–ú–û 2)
    
    '
    grub_() {
    arch-chroot /mnt /bin/bash -c "mkinitcpio -P" # –∫–æ–º–ø–∏–ª—è—Ü–∏—è —è–¥—Ä–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
    #–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
    arch-chroot /mnt /bin/bash -c "pacman -Syy grub grub-btrfs efibootmgr --noconfirm"
    Uefi="grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB --no-nvram --removable /dev/$DISK"
    arch-chroot /mnt /bin/bash -c "${Uefi}"
    arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
    #---–∑–∞–≥–ª—É—à–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–≤–æ–¥–∞ –∫–æ–º–º–∞–Ω–¥
    stop_
    #--------------------------------------------------------------------
    }
    #-----------------searh windows grub-----------------------
    #–ü–æ–º–æ–≥–∞–µ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫—É –Ω–∞–π—Ç–∏ Windows –¥–ª—è –¥–≤–æ–π–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
    #–ï—Å–ª–∏ GRUB –Ω–µ –≤–∏–¥–∏—Ç Windows, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ Arch:
    searhwin() {
    arch-chroot /mnt /bin/bash -c "pacman -S os-prober --noconfirm"
    arch-chroot /mnt /bin/bash -c "sed -i s/'GRUB_TIMEOUT=5'/'GRUB_TIMEOUT=30'/g /etc/default/grub"
    arch-chroot /mnt /bin/bash -c "sed -i s/'#GRUB_DISABLE_OS_PROBER=false'/'GRUB_DISABLE_OS_PROBER=false'/g /etc/default/grub"
    arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
    #---–∑–∞–≥–ª—É—à–∫–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—ã–≤–æ–¥–∞ –∫–æ–º–º–∞–Ω–¥
    stop_   
    }
    PS3="–í—ã–±–µ—Ä–∏—Ç–µ :"
    select choice in "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ GRUB"  "–ü–û–ò–°–ö WINDOWS" "–ö–æ–º–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞- arch-chroot" "GAME OVER REBOOT" "EXIT –∏–∑ –º–µ–Ω—é"; do
        case $REPLY in
        1) grub_;break;;                    # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
        2) searhwin;break;;                 # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
        3) arch-chroot /mnt;break;;         # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
        4) arch-chroot /mnt /bin/bash -c "exit";umount -R /mnt;reboot;break;;   # –í—ã—Ö–æ–¥–∏–º –∏–∑ select –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º —Ü–∏–∫–ª while
        5) return 0 ;;                      # –í—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é
        *) echo "Wrong choice!";;
        esac
    done
done
}
#========================================================================================
#______________________rEFInd___________________________________________________________
# –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ rEFInd –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–≤–æ–π–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
install_refind_with_windows() {
    local boot_partition="$1"  # –ü–æ–ª—É—á–∞–µ–º —Ä–∞–∑–¥–µ–ª EFI (–Ω–∞–ø—Ä–∏–º–µ—Ä, "nvme0n1p1")

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞
    if [[ -z "$boot_partition" ]]; then
        echo "–û—à–∏–±–∫–∞: –£–∫–∞–∂–∏—Ç–µ EFI-—Ä–∞–∑–¥–µ–ª –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, nvme0n1p1)"
        return 1
    fi

    # –ü—É—Ç–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Arch)
    local efi_mount_point="/mnt/boot/efi"
    local dev_path="/dev/${boot_partition}"

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∞
    if [[ ! -b "$dev_path" ]]; then
        echo "–û—à–∏–±–∫–∞: –†–∞–∑–¥–µ–ª $dev_path –Ω–µ –Ω–∞–π–¥–µ–Ω!"
        return 1
    fi

    # –°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    echo "–°–æ–∑–¥–∞–µ–º —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è EFI..."
    mkdir -p "$efi_mount_point" || {
        echo "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å $efi_mount_point"
        return 1
    }

    # –ú–æ–Ω—Ç–∏—Ä—É–µ–º EFI-—Ä–∞–∑–¥–µ–ª
    echo "–ú–æ–Ω—Ç–∏—Ä—É–µ–º EFI-—Ä–∞–∑–¥–µ–ª $dev_path –≤ $efi_mount_point..."
    mount "$dev_path" "$efi_mount_point" || {
        echo "–û—à–∏–±–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è EFI-—Ä–∞–∑–¥–µ–ª–∞!"
        return 1
    }

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ rEFInd —á–µ—Ä–µ–∑ pacman
    echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞–∫–µ—Ç refind..."
    pacman -Sy refind --noconfirm || {
        echo "–û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ refind!"
        umount "$efi_mount_point"
        return 1
    }

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
    echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º rEFInd –≤ EFI-—Å–∏—Å—Ç–µ–º—É..."
    refind-install --root /mnt || {
        echo "–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è refind-install!"
        umount "$efi_mount_point"
        return 1
    }

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ rEFInd
    local refind_conf="/mnt/boot/efi/EFI/refind/refind.conf"
    echo "–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª rEFInd..."

    # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –∫–æ–Ω—Ñ–∏–≥–∞
    cp "$refind_conf" "${refind_conf}.bak"

    # –í–∫–ª—é—á–∞–µ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –û–°
    sed -i 's/#scan_all_linux_kernels false/scan_all_linux_kernels true/' "$refind_conf"
    sed -i 's/#scanfor internal,external,optical,manual/scanfor internal,external,manual/' "$refind_conf"

    # –î–æ–±–∞–≤–ª—è–µ–º —Ä—É—á–Ω—É—é –∑–∞–ø–∏—Å—å –¥–ª—è Windows (–µ—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
    if ! grep -q "Windows Boot Manager" "$refind_conf"; then
        echo -e "\n# –†—É—á–Ω–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è Windows 11" >> "$refind_conf"
        echo 'menuentry "Windows 11" {' >> "$refind_conf"
        echo '    loader /EFI/Microsoft/Boot/bootmgfw.efi' >> "$refind_conf"
        echo '    icon /EFI/refind/icons/os_win.png' >> "$refind_conf"
        echo '}' >> "$refind_conf"
    fi

    # –û–±–Ω–æ–≤–ª—è–µ–º initramfs (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —è–¥–µ—Ä)
    echo "–û–±–Ω–æ–≤–ª—è–µ–º initramfs..."
    arch-chroot /mnt mkinitcpio -P || {
        echo "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è initramfs!"
        return 1
    }

    # –§–∏–∫—Å–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫ –≤ UEFI
    echo "–î–æ–±–∞–≤–ª—è–µ–º rEFInd –≤ UEFI-–∑–∞–≥—Ä—É–∑–∫—É..."
    efibootmgr --create --disk "/dev/$(echo $boot_partition | sed 's/[0-9]*$//')" \
               --part "$(echo $boot_partition | grep -o '[0-9]*$')" \
               --loader /EFI/refind/refind_x64.efi \
               --label "rEFInd Boot Manager" \
               --verbose

    # –†–∞–∑–º–æ–Ω—Ç–∏—Ä—É–µ–º EFI-—Ä–∞–∑–¥–µ–ª
    umount "$efi_mount_point"

    echo -e "\n[–£–°–ü–ï–®–ù–û] rEFInd —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –¥–≤–æ–π–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å Windows 11!"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ: $refind_conf"
}
# –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏
# install_refind_with_windows "nvme0n1p1"

#=================================================================================================
#_______________________install_refind_______________________________________
#!/bin/bash

install_refind() {
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root
    if [[ $EUID -ne 0 ]]; then
        echo "‚ùå –û—à–∏–±–∫–∞: –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å –ø—Ä–∞–≤–∞–º–∏ root" >&2
        return 1
    fi

    # –ü—É—Ç–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    local efi_mount_point="/mnt/boot/efi"
    local refind_dir="$efi_mount_point/EFI/refind"
    local refind_conf="$refind_dir/refind.conf"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è EFI
    if ! mountpoint -q "$efi_mount_point"; then
        echo "‚ùå –û—à–∏–±–∫–∞: EFI —Ä–∞–∑–¥–µ–ª –Ω–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ $efi_mount_point" >&2
        echo "–í—ã–ø–æ–ª–Ω–∏—Ç–µ: mount /dev/$boot $efi_mount_point" >&2
        return 1
    fi

    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
    echo "‚åõ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –≤ —Ü–µ–ª–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É..."
    if ! pacstrap /mnt refind efibootmgr dosfstools ntfs-3g; then
        echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤!" >&2
        return 1
    fi

    # –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤
    echo "üìÇ –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
    mkdir -p "$refind_dir/drivers" || {
        echo "‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π!" >&2
        return 1
    }

    # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–æ–≤ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
    echo "üîß –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–æ–≤..."
    declare -A drivers=(
        ["ext4"]="/usr/share/refind/drivers_x64/ext4_x64.efi"
        ["ntfs"]="/usr/share/refind/drivers_x64/ntfs_x64.efi"
        ["btrfs"]="/usr/share/refind/drivers_x64/btrfs_x64.efi"
    )

    for driver in "${!drivers[@]}"; do
        src_path="${drivers[$driver]}"
        if [ -f "/mnt$src_path" ]; then
            cp -f "/mnt$src_path" "$refind_dir/drivers/" || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å $driver" >&2
        else
            echo "‚ö†Ô∏è –î—Ä–∞–π–≤–µ—Ä $driver –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–∞–∫–µ—Ç–µ, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º..." >&2
        fi
    done

    # –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ NTFS –¥—Ä–∞–π–≤–µ—Ä–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
    if [ ! -f "$refind_dir/drivers/ntfs_x64.efi" ]; then
        echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NTFS –¥—Ä–∞–π–≤–µ—Ä–∞ –∏–∑ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞..."
        wget -qO /tmp/ntfs_x64.efi https://github.com/anthraxx/refind-ntfs/raw/master/ntfs_x64.efi
        cp -f /tmp/ntfs_x64.efi "$refind_dir/drivers/ntfs_x64.efi"
        rm -f /tmp/ntfs_x64.efi
    fi

    # –û—Å–Ω–æ–≤–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ rEFInd
    echo "üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ rEFInd..."
    if ! arch-chroot /mnt refind-install \
        --root /mnt \
        --alldrivers \
        --yes \
        --localkeys \
        --keepname; then
        echo "‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ rEFInd!" >&2
        return 1
    fi

    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
    cp -f "$refind_conf" "${refind_conf}.bak"  # –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è

    # –í–∫–ª—é—á–µ–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    sed -i 's/^#\(scan_all_linux_kernels\)/\1/' "$refind_conf"
    sed -i 's/^#\(scan_for\)/\1 external,internal/' "$refind_conf"

    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Windows
    if ! grep -q "Windows Boot Manager" "$refind_conf"; then
        echo -e "\n# Windows Boot Manager" >> "$refind_conf"
        echo 'menuentry "Windows 11" {' >> "$refind_conf"
        echo '    icon /EFI/refind/icons/os_win.png' >> "$refind_conf"
        echo '    loader /EFI/Microsoft/Boot/bootmgfw.efi' >> "$refind_conf"
        echo '    ostype Windows' >> "$refind_conf"
        echo '}' >> "$refind_conf"
    fi

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UEFI –∑–∞–ø–∏—Å–µ–π
    echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UEFI –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö..."
    local disk_device="${boot%%[0-9]*}"
    local part_number="${boot//[^0-9]/}"
    
    efibootmgr -c -d "/dev/$disk_device" -p "$part_number" \
        -L "rEFInd Boot Manager" \
        -l '\EFI\refind\refind_x64.efi' >/dev/null 2>&1

    # –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
    sync
    echo -e "\n‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:"
    echo "1. –ó–∞–ø–∏—Å–∏ UEFI: efibootmgr -v"
    echo "2. –ù–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ $efi_mount_point/EFI"
    echo "3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é: $refind_conf"
}

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
# export boot="nvme0n1p1"
# install_refind

##############################################################################################
#________________–í—ã–±–æ—Ä –∑–∞–≥—Ä—É–∑—á–∏–∫–∞_____________________________________
PS3=" –í—ã–±–µ—Ä–∏—Ç–µ :"
    select choice in "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ GRUB"  "—É—Å—Ç–∞–Ω–æ–≤–∫–∏ rEFInd –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–≤–æ–π–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏" "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ rEFInd –æ–¥–Ω–∞—Ä–Ω–∞—è –∏ –¥–≤–æ–π–Ω–∞—è —Å –≤–∏–Ω–¥–æ–≤—Å" "–ö–æ–º–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞- arch-chroot" "GAME OVER REBOOT" "EXIT –∏–∑ –º–µ–Ω—é"; do
        case $REPLY in
        1) zagruzchik;break;;                    # –í—ã—Ö–æ–¥–∏–º –∏–∑ select 
        2) install_refind_with_windows $boot;break;;   # –í—ã—Ö–æ–¥–∏–º –∏–∑ select 
        3) install_refind;break;;
        4) arch-chroot /mnt;break;;         # –í—ã—Ö–æ–¥–∏–º –∏–∑ select 
        5) arch-chroot /mnt /bin/bash -c "exit";umount -R /mnt;reboot;break;;
        6) exit;; 
        *) echo "Wrong choice!";;
        esac
    done

# end    